---
description: Coding standards and conventions for the macOS Meeting Transcriber Swift/SwiftUI project
globs: "**/*.swift"
---

# Project: macOS Meeting Transcriber

## Language & Framework
- Swift 5.9+ with strict concurrency checking enabled
- SwiftUI for all UI components
- Async/await for all asynchronous operations
- Use Swift's new Observation framework (@Observable) over ObservableObject where possible

## Code Style
- Follow Swift API Design Guidelines
- Use meaningful names: `transcriptionManager` not `tm` or `manager`
- Prefer value types (structs) over classes unless reference semantics needed
- Use extensions to organize protocol conformances
- Mark classes as `final` unless designed for inheritance

## Architecture Patterns
- MVVM for UI layers
- Repository pattern for data access
- Use dependency injection via initializers, not singletons
- Prefer composition over inheritance

## Error Handling
- Define typed errors with enums conforming to LocalizedError
- Never force unwrap (!) except in tests or truly impossible cases
- Use Result type or throws, not optional returns for fallible operations

## Concurrency
- Use actors for shared mutable state
- Main actor for all UI updates
- Use TaskGroup for parallel operations
- Always handle task cancellation

## ScreenCaptureKit Specifics
- Always check for screen recording permission before capture
- Handle SCStream errors gracefully (user denial, app quit, etc.)
- Use SCStreamDelegate for audio sample handling
- Convert CMSampleBuffer to raw PCM for Whisper

## Audio Processing
- Whisper expects: 16kHz, mono, Float32 PCM
- Use vDSP for audio format conversion (Apple Accelerate framework)
- Buffer management: ring buffer for real-time streaming
- Always drain buffers on stop to capture final audio

## File Structure
- One type per file (exceptions: small related types)
- Group by feature, not by type
- Test files mirror source structure in Tests/

## Comments
- Document public APIs with /// comments
- Explain "why" not "what" in implementation comments
- Mark TODOs with: // TODO: (username) - description

## Testing
- Unit test all business logic
- Use protocols/dependency injection for testability
- Mock external dependencies (ScreenCaptureKit, file system)

## Performance
- Profile with Instruments before optimizing
- Use lazy initialization for expensive resources
- Release audio buffers promptly to avoid memory growth

## Dependencies
- Prefer Apple frameworks over third-party when comparable
- Vet any third-party dependency for maintenance status
- Document why each dependency is needed

## Git
- Conventional commits: feat:, fix:, refactor:, docs:, test:
- Keep commits atomic and focused

